# Vue3 登录系统

一个基于 Vue3 + Vite + Pinia 的现代化登录页面应用。

## 功能特性

- 🎨 现代化的UI设计，支持响应式布局
- 🔐 完整的登录/登出功能
- 📱 移动端适配
- 🛡️ 路由守卫和认证保护
- 📦 基于 Pinia 的状态管理
- 🔄 自动token管理和API拦截器
- ✨ 表单验证和错误处理
- 🎯 社交登录入口（可扩展）

## 技术栈

- **前端框架**: Vue 3.3.4
- **构建工具**: Vite 4.4.9
- **状态管理**: Pinia 2.1.6
- **路由管理**: Vue Router 4.2.4
- **HTTP客户端**: Axios 1.5.0
- **样式**: CSS3 + 响应式设计

## 项目结构

```
frontend/
├── src/
│   ├── api/           # API接口
│   ├── components/    # 公共组件
│   ├── router/        # 路由配置
│   ├── stores/        # Pinia状态管理
│   ├── views/         # 页面组件
│   ├── App.vue        # 根组件
│   ├── main.js        # 应用入口
│   └── style.css      # 全局样式
├── index.html         # HTML模板
├── package.json       # 项目配置
├── vite.config.js     # Vite配置
└── README.md          # 项目说明
```

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

应用将在 `http://localhost:3000` 启动

### 3. 构建生产版本

```bash
npm run build
```

### 4. 预览生产版本

```bash
npm run preview
```

## 使用说明

### 登录功能

1. 访问登录页面
2. 输入用户名和密码
3. 点击登录按钮
4. 登录成功后自动跳转到成功页面

### 测试账号

由于目前没有后端服务，您可以：
- 在浏览器控制台查看API调用
- 修改 `src/api/auth.js` 中的API地址指向您的后端服务
- 或者添加模拟数据进行测试

### 路由说明

- `/` - 重定向到登录页
- `/login` - 登录页面
- `/success` - 登录成功页面（需要认证）

## 自定义配置

### 修改API地址

编辑 `src/api/auth.js` 文件中的 `baseURL`：

```javascript
const api = axios.create({
  baseURL: 'http://your-backend-url/api', // 修改为您的后端地址
  // ...
})
```

### 修改样式主题

编辑 `src/style.css` 文件中的CSS变量来修改主题色彩。

## 开发指南

### 添加新页面

1. 在 `src/views/` 目录下创建新的Vue组件
2. 在 `src/router/index.js` 中添加路由配置
3. 根据需要添加路由守卫

### 添加新功能

1. 在 `src/stores/` 目录下创建新的Pinia store
2. 在 `src/api/` 目录下添加相应的API接口
3. 在组件中使用store和API

## 浏览器支持

- Chrome >= 87
- Firefox >= 78
- Safari >= 14
- Edge >= 88

## 许可证

MIT License

# 前端用户信息编辑功能测试说明

## 功能概述
前端已成功连接到后端用户信息更新接口，支持：
- 修改用户名
- 修改邮箱地址
- 修改密码
- 上传/下载头像
- **页面刷新后状态保持**（已修复）

## 修复的问题
✅ **路由刷新后状态丢失** - 已修复  
✅ **缺少路由守卫** - 已添加  
✅ **初始化时机问题** - 已优化  
✅ **认证状态恢复** - 已实现  
✅ **邮箱显示不匹配** - 已修复  
✅ **邮箱文本截断** - 已修复  
✅ **头像刷新后消失** - 已修复

## 测试步骤

### 1. 启动服务
```bash
# 启动后端
cd backend
python start_server.py

# 启动前端
cd frontend
npm run dev
```

### 2. 登录测试
1. 访问前端登录页面
2. 使用有效用户名和密码登录
3. 登录成功后，检查浏览器控制台和localStorage，确认：
   - token已保存
   - 用户信息包含user_id

### 3. 测试页面刷新后状态保持
1. 登录后访问"用户信息"页面
2. **刷新页面**（F5或Ctrl+R）
3. 检查用户信息是否仍然显示
4. 确认导航栏中的用户名仍然显示

### 4. 测试邮箱显示正确性
1. 在"用户信息"页面检查邮箱显示
2. 确认邮箱地址完整显示，不被截断
3. 对比数据库中的邮箱地址，确认一致
4. 如果邮箱显示不正确，检查后端API是否正常

### 5. 测试用户信息编辑
1. 在"用户信息"页面点击"编辑"按钮
2. 修改用户名或邮箱
3. 点击"保存更改"
4. 检查：
   - 是否显示"保存成功"
   - 修改后的信息是否正确显示
   - 后端数据库中用户信息是否已更新

### 6. 测试密码修改
1. 在"安全设置"区域点击"修改密码"
2. 输入新密码（至少6位）
3. 确认新密码
4. 点击"确认修改"
5. 检查是否显示"密码修改成功"

### 7. 测试头像功能
1. 点击头像区域选择图片文件
2. 检查是否自动上传并显示
3. 点击"下载头像"测试下载功能

### 8. 测试头像持久化
1. 上传头像成功后，**刷新页面**（F5或Ctrl+R）
2. 检查头像是否仍然显示
3. 确认头像没有消失或变成默认图标
4. 检查浏览器控制台，确认头像加载过程

## 后端接口
- **获取用户信息**: `GET /api/auth/users/{user_id}`
- **更新用户信息**: `PUT /api/auth/users/{user_id}`
- **上传头像**: `POST /api/auth/users/{user_id}/avatar`
- **获取头像**: `GET /api/auth/users/{user_id}/avatar`

## 技术实现
- **路由守卫**: 自动检查认证状态，未登录用户重定向到登录页
- **状态持久化**: 使用localStorage保存token和用户信息
- **自动恢复**: 应用启动时自动恢复用户认证状态
- **响应式更新**: 使用Vue3 Composition API和Pinia状态管理
- **头像缓存**: 使用localStorage缓存头像状态，确保刷新后不丢失

## 注意事项
1. 确保后端数据库已添加avatar相关字段
2. 确保用户已登录且token有效
3. 用户名至少3个字符，邮箱格式正确
4. 密码至少6个字符
5. **页面刷新后用户信息会自动恢复**
6. **头像上传后会自动缓存状态，刷新后保持显示**

## 故障排除
- 如果编辑失败，检查浏览器控制台错误信息
- 如果头像上传失败，检查文件大小和格式
- 如果接口调用失败，检查后端服务是否正常运行
- **如果刷新后状态丢失，检查localStorage中是否有token和user信息**
- **如果头像刷新后消失，检查localStorage中的avatar状态和浏览器控制台日志**